#!/usr/bin/env bats
#
# {{ ansible_managed }} [ansible-playbooks v{{ ansibleplaybooks_version }}]
# 
# vim: set ts=4 sw=4 tw=0 et :

# This test needs to be run with sudo as iptables requires root
# privileges.

{% for chain in ['INPUT', 'FORWARD', 'OUTPUT', 'DOCKER' ] %}
@test "[S][EV] iptables: Chain {{ chain }} exists" {
    [ "iptables -L {{ chain }} 2>&1 >/dev/null" ]
}

@test "[S][EV] ip6tables: Chain {{ chain }} exists" {
    [ "ip6tables -L {{ chain }} 2>&1 >/dev/null" ]
}
{% endfor %}

@test "[S][EV] iptables: Default INPUT policy DROP" {
	[ "$(iptables -L INPUT | head -n1)" == "Chain INPUT (policy DROP)" ]
}

@test "[S][EV] iptables: Default FORWARD policy DROP" {
	[ "$(iptables -L FORWARD | head -n1)" == "Chain FORWARD (policy DROP)" ]
}

@test "[S][EV] iptables: Default OUTPUT policy ACCEPT" {
	[ "$(iptables -L OUTPUT | head -n1)" == "Chain OUTPUT (policy ACCEPT)" ]
}
